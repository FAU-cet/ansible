# Generated by Anaconda 34.25.1.14
# Generated by pykickstart v3.32
#version=RHEL9

# Use none-intractive install // changed from grafical
text --non-interactive

url --url=https://ftp.fau.de/almalinux/9.1/BaseOS/x86_64/os/

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

# Keyboard layouts
keyboard --xlayouts='us'
# System language
lang en_US.UTF-8


# Network information
#network  --onboot=yes --device=ens160 --bootproto=dhcp --noipv6 --activate
#network  --hostname=almalinux-custom.localdomain
network --activate

%packages
@^server-product-environment

%end

# Run the Setup Agent on first boot
firstboot --enable

# System timezone
timezone Europe/Berlin --utc
# timesource --ntp-server ntp0.fau.de

sshkey --username=root "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDK4kzsmekvq74ted6mXulGPKkLX5WyFfxYtnfN5bU+EBjBEE78VEakm8j9MuhFGZ4UiDvQcxPoGvZYYVf7uUABkYapdbQS1XxAXfqKpJMuoG9CBufqRe4rKManXmaPALBgumB5Fvx4F41VtkqzwgI5QHPMb1fTx7HeCxJ+26/Iwjhbllf2WclDYuPlLC8DUPnduly0TYDWcbwg1C5dp13sApj5yA+5fji3BANCQpyQxdYlEq/sePnm+MC0LTFLVAOdo/6uvcAR+NQHlTv8B8MV4vXlOn81NiqbpeoAsvRPu1ip9jrxGGEumuo7AqhZnJ5uUrtjl9PxWwXmK+uuHQGorMlg2UK8XbJv8CY+fU+NwNsyxxTYF+9ePsON/1pWaUeZt0QHHiIY5lFx/UMKpkAOpW2mu/uiTlcjI/KUso7GcBEExzIqwsF/nA9LFkxFHY2WBBDIB2fSbbtULpODOoG0klgtVLJ4bZwdAVidvOGkdqQq2EgnTvtKfHLwF/2Ay4s= nils@NiLS-Linux-Aspire-A515-55G
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIItQX/CAQ5Zpg32Pu31vnouC+yMdI68Y2dJVUcto/tc0 philipp.g231@gmx.de
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCezh4XcKnbkFxLIbGUciI/7xF7Sd0EH2TuLyTPGcta/OFTnVcO4I4o/O0v6Y0tln2fMkY5IryGqKtHHe7SVInOTjw+gDkssME0VPLoNtOtqsKOUfykmGUgipXVR6NUgWPh6RY+ZITWhv39EWiAQguA42fyd1nYgvX6OfeW+cu7vSMJhK+d0oR6IZxt83zB3stUfWpn406fay4gpJ9qL7JS/ued9L7KBvYy8xFEI2V8H2dvTpHGCAWd9XqVn/s2bJkXv3ImSDnPENF8WFcztEbgpzl58pwbVQFxxEkEWARkdNqpeP2CyLldbvHNZ7efhg7bRM7bMWcsnYrKKkmjXi4G+KBpi9GITIRFF9ngEGdPJsLnWcsDuQo/3grwOzzWiEU2YyRsSU/fVkoSvLDHasXq0GQOY5sN3C+haBaLRWHrqTcA+6HdIfmLMNrhgm8YEqTH0E1rUS6zrtBhZf7L98pjoqU487RYR0bNUzHgM7MKMd/gB7ptNlOyTum83v9TVm0= christoph@Elitebook
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGvPgtASdDXgtF8bf0kqU52kJ0CDtj5+ZFzXiGOviCxo mo66tufu@fedora
"
# Root password
rootpw --iscrypted $6$cOz7lbJSW9YNSN02$D2ZH4NTsz2NGh9ZDf.H84B8SyWQeeNUFapHXyjwC4SQJXtm1kBNEb.ImqPwm791A6OZjZyNY5RlXYS3ZC1Yqg/

# acsept license
eula --agreed

reboot

%pre
#!/bin/bash
selected_disk=""
for disk in $(lsblk -n -b -o SIZE,NAME | awk '$1 >= 400*1024*1024*1024 && $1 <= 500*1024*1024*1024 {print $2}'); do
  if [[ -z "$selected_disk" ]]; then
    selected_disk=$disk
  fi
done
echo "test"
echo "clearpart --all --initlabel --drives $selected_disk" > /tmp/disk_selection.ks
echo "part /boot --fstype ext4 --size 1024 --ondisk $selected_disk" >> /tmp/disk_selection.ks
echo "part pv.01 --grow --size=1 --ondisk $selected_disk" >> /tmp/disk_selection.ks
echo "volgroup alma --pesize 4096 pv.01" >> /tmp/disk_selection.ks
echo "logvol / --fstype xfs --name root --vgname alma --size 71680" >> /tmp/disk_selection.ks
echo "logvol swap --fstype swap --name swap --vgname alma --size 8192" >> /tmp/disk_selection.ks
echo "logvol /home --fstype xfs --name home --vgname alma --size 1 --grow" >> /tmp/disk_selection.ks
echo "bootloader --boot-drive $selected_disk --driveorder $selected_disk --loaction partition" >>/tmp/disk_selection.ks

%end

%include /tmp/disk_selection.ks

%post
echo "server ntp0.fau.de" >> /etc/ntp.conf
systemctl enable --now ntpd
%end